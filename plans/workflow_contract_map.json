{
  "schema_version": "1.0",
  "rules": [
    {
      "id": "WF-0.1",
      "title": "Trading behavior rules CONTRACT.md is canonical. If this workflow contract conflicts with CONTRACT.md on behavior, STOP and set needs human decision=true.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-0.2",
      "title": "Workflow/process rules this file is canonical. If other workflow docs conflict with this file, this file wins.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.1",
      "title": "CONTRACT.md (canonical trading contract)",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.2",
      "title": "IMPLEMENTATION PLAN.md (slice map; may be specs/IMPLEMENTATION PLAN.md )",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.3",
      "title": "plans/prd.json  story backlog (machine readable)",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.4",
      "title": "plans/ralph.sh  execution harness (iterative loop)",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.5",
      "title": "plans/verify.sh  verification gate (CI must run this)",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.6",
      "title": "plans/progress.txt  append only shift handoff log",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.1",
      "title": "Contract alignment is mandatory.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.2",
      "title": "Verification is mandatory.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.3",
      "title": "WIP = 1 (Ralph execution only).",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.4",
      "title": "Slices are executed in order.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.5",
      "title": "No cheating.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.6",
      "title": "plans/ralph.sh MUST exit non zero on any gate failure and MUST leave a diagnostic artifact under .ralph/ explaining the stop reason.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.0",
      "title": "The PRD applies only to Ralph loop execution (implementation stories). Workflow maintenance tasks are not entered into PRD; they are handled via 11 Change Control.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.1",
      "title": "plans/prd.json MUST be valid JSON with this shape",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.2",
      "title": "Ralph MUST validate required top level keys exist project, source, rules, items.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.3",
      "title": "Ralph MUST validate for every item required fields per 3 are present; acceptance has  3 entries; steps has  5 entries; verify[] contains ./plans/verify.sh.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.4",
      "title": "Ralph MUST validate if needs human decision=true then human blocker object is present.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.5",
      "title": "Each item MUST include",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.6",
      "title": "If needs human decision=true, item MUST also include",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.1",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.2",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.3",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.4",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.5",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.6",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.7",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.0",
      "title": "Ralph is the only allowed automation for overnight changes. This loop applies to PRD execution only; workflow maintenance tasks follow 11 and do not require PRD items.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.1",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.2",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.3",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.4",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.5",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.5.1",
      "title": "verify.sh MUST enforce the endpoint level test gate if endpoint ish files change, corresponding tests must change, unless ENDPOINT GATE=0 in a non CI run.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.6",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.7",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.8",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.9",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.10",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.11",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.12",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.13",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-6.1",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-6.2",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-6.3",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-7.1",
      "title": "Rule after a story is implemented and verify post is green, a contract check MUST occur.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-7.2",
      "title": "Each iteration with verify post green MUST produce .ralph/iter /contract review.json",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-7.3",
      "title": "The artifact MUST conform to docs/schemas/contract review.schema.json (decision PASS|FAIL|BLOCKED) and the validator MUST load that schema.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-7.4",
      "title": "If the contract review artifact is missing or decision!=\"PASS\",",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.1",
      "title": "CI MUST execute",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.2",
      "title": "./plans/verify.sh MUST print a single line at start VERIFY SH SHA=<hash .",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.3",
      "title": "Ralph MUST capture this line in .ralph/iter /verify pre.log and verify post.log.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.4",
      "title": "CI logs (or CI artifacts) MUST contain the same VERIFY SH SHA line for the run.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.5",
      "title": "./plans/verify.sh MUST fail with <promise BLOCKED CI COMMANDS</promise if CI GATES SOURCE is not github/verify and no .github/workflows directory is present.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-9.1",
      "title": "plans/progress.txt is append only and MUST include per iteration entries",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-10.1",
      "title": "When Ralph stops on a blocked story",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-11.1",
      "title": "This file is canonical. Any workflow changes MUST be",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-11.2",
      "title": "Workflow maintenance tasks (changes to this contract or harness scripts) are not PRD stories and are outside the Ralph WIP=1 rule, but they still must honor 2.1 Contract alignment and 2.2 Verification.",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.1",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.2",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.3",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.4",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.5",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.6",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.7",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.8",
      "title": "Workflow rule",
      "enforcement": [
        "manual"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    }
  ]
}
